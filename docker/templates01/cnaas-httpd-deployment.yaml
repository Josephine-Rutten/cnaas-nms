apiVersion: apps/v1
kind: Deployment
metadata:
  labels:
    io.kompose.service: cnaas-httpd
  name: cnaas-httpd
spec:
  replicas: 1
  selector:
    matchLabels:
      io.kompose.service: cnaas-httpd
  strategy:
    type: Recreate
  template:
    metadata:
      labels:
        io.kompose.service: cnaas-httpd
    spec:
      containers:
        # - env:
        #     - name: GIT_TOKEN
        #       valueFrom:
        #         secretKeyRef:
        #           name: cnaas-credentials
        #           key: git-token
        #     - name: GITREPO_TEMPLATES
        #       value: "https://cnaas:$(GIT_TOKEN)@gitlab.surf.nl/surf-wired/cnaas-templates.git"
        - image: {{ .Values.httpd.image }}
          name: cnaas-httpd
          ports:
            - containerPort: 1180
          resources: {}
          volumeMounts:
            - mountPath: /opt/git
              name: cnaas-httpd-claim0
            - mountPath: /opt/cnaas/www/firmware
              name: cnaas-httpd-claim1
            # - name: secrets-store01-inline
            #   mountPath: "/mnt/secrets-store"
            #   readOnly: true
      restartPolicy: Always
      volumes:
        - name: cnaas-httpd-claim0
          persistentVolumeClaim:
            claimName: cnaas-httpd-claim0
        - name: cnaas-httpd-claim1
          persistentVolumeClaim:
            claimName: cnaas-httpd-claim1
        # - name: secrets-store01-inline
        #   csi:
        #     driver: secrets-store.csi.k8s.io
        #     readOnly: true
        #     volumeAttributes:
        #       secretProviderClass: "azure-kvname-user-msi"
status: {}
